<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content=BlahCats name=author><meta content="Tales of a binary encoded life..." name=description><meta prefix="og: http://ogp.me/ns#" content=BlahCats property=og:site_name><meta prefix="og: http://ogp.me/ns#" content=blog property=og:type><meta content="Goodbye VirtualBox, hello Hyper-V" prefix="og: http://ogp.me/ns#" property=og:title><meta content="Goodbye VirtualBox, hello Hyper-V - by hugsy" prefix="og: http://ogp.me/ns#" property=og:description><meta prefix="og: http://ogp.me/ns#" content=en_US property=og:locale><meta prefix="og: http://ogp.me/ns#" content=https://blahcat.github.io/2018-12-30-goodbye-virtualbox-hello-hyper-v property=og:url><meta prefix="og: http://ogp.me/ns#" content=https://blahcat.github.io/img/vbox-to-hyperv-header.png property=og:image><meta content=summary_large_image name=twitter:card><meta content=@ctf_blahcat name=twitter:site><meta content=BlahCats name=twitter:title><meta content="Goodbye VirtualBox, hello Hyper-V - by hugsy" name=twitter:description><meta content=https://blahcat.github.io/2018-12-30-goodbye-virtualbox-hello-hyper-v name=twitter:url><meta content=https://blahcat.github.io/img/vbox-to-hyperv-header.png name=twitter:image:src><script type=application/ld+json>
    {
      "@context" : "http://schema.org",
      "@type" : "Website",
      "name": " BlahCats",
      "url" : "https://blahcat.github.io/2018-12-30-goodbye-virtualbox-hello-hyper-v",
      
      "image": https://blahcat.github.io/img/vbox-to-hyperv-header.png",
      
      
      "description": Goodbye VirtualBox, hello Hyper-V - by hugsy",
      
    }
    </script><title>
  Goodbye VirtualBox, hello Hyper-V
</title><link href=https://blahcat.github.io/img/favicon.ico rel=icon type=image/x-icon><link href=https://blahcat.github.io/css/bootstrap.min.css rel=stylesheet><link href=" https://blahcat.github.io/css/all.min.css" rel=" stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Montserrat:400,300" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Lato" -- <!-- custom for rel=stylesheet styles template this><link href=https://blahcat.github.io/css/clean-blog.css rel=stylesheet><link href=https://blahcat.github.io/css/overrides.css rel=stylesheet><link integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css referrerpolicy=no-referrer rel=stylesheet><body><nav class="navbar navbar-expand-lg navbar-light fixed-top" id=mainNav><div class=container><a class=navbar-brand href=https://blahcat.github.io>BlahCats Blog</a><button aria-label="Toggle navigation" class="navbar-toggler navbar-toggler-right" aria-controls=navbarResponsive aria-expanded=false data-target=#navbarResponsive data-toggle=collapse type=button>Menu <i class="fas fa-bars"></i></button><div class="collapse navbar-collapse" id=navbarResponsive><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://blahcat.github.io>Home</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/series>Series</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/notes>Notes</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/about>About</a><li class=nav-item><a class=nav-link href=https://blahcat.github.io/qemu>Qemu VMs</a></ul></div></div></nav><header class=masthead style=background-image:url(https://blahcat.github.io/img/vbox-to-hyperv-header.png)><div class=overlay></div><div class=container><div class=row><div class="col-lg-8 col-md-10 mx-auto"><div class=post-heading><h1>Goodbye VirtualBox, hello Hyper-V</h1><span class=meta> <b> ‚Ä¢ <a href=/author/hugsy>hugsy</a> ‚Ä¢ </b> 30 December 2018 <br> <br> <i>Reading time: 4 min</i> </span></div></div></div></div></header><article><article class=post><div class=container><div class=row><div class="col-lg-8 col-md-10 mx-auto"><p>A few scrap notes about my migration from VirtualBox to Hyper-V (in case I attempt to do the same again in the future üòÅ)<h2 id=moving-a-virtualbox-vm-to-hyper-v>Moving a VirtualBox VM to Hyper-V</h2><p>Hyper-V doesn‚Äôt support OVF/OVA format, but it is possible to convert a VBox VDI to HV VHD by:<ol><li>In VirtualBox: copy the hard drive from <strong>File</strong> ‚Üí <strong>Virtual Media Manager</strong>. Select the target image and <strong>Copy</strong> it making sure that the output format is VHD<li>In Hyper-V, open the <strong>Edit Disk</strong> wizard from the selected host. Select the VHD created above and choose to convert to VHDX.<li>Still in Hyper-V, when creating the VM, simply point to that VHDX in the Hard Drive section.</ol><p>Done.<h2 id=enabling-enhanced-session-mode-for-ubuntu-or-arch-linux>Enabling ‚ÄúEnhanced Session‚Äù mode for Ubuntu or Arch Linux</h2><p>Creating a (recent) Windows VM in Hyper-V will automatically build a smooth environment, but with Linux not much. This is because the ‚ÄúEnhanced Session‚Äù is not available, preventing to do simple stuff like:<ul><li>Clipboard support<li>Dynamic desktop resizing<li>Shared folders & drive redirection<li>Seamless mouse sharing</ul><p>MS rectified the shoot by releasing the <a rel="noopener nofollow noreferrer" href=https://github.com/Microsoft/linux-vm-tools target=_blank>Linux VM Tools</a> last October. Quick how-to:<ol><li>Git-Clone https://github.com/Microsoft/linux-vm-tools</ol><pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#65737e># for ubuntu 18.04
</span><span style=color:#bf616a>$</span><span> git clone https://github.com/Microsoft/linux-vm-tools
</span><span style=color:#bf616a>$</span><span> cd linux-vm-tools/ubuntu/18.04
</span><span style=color:#bf616a>$</span><span> chmod +x ./install.sh
</span><span style=color:#bf616a>$</span><span> sudo ./install.sh
</span></code></pre><ol start=2><li>Wait for the install to finish<li>Disable the autologin (<strong>User settings</strong> ‚Üí <strong>Autologin</strong> set to Off)<li>Shutdown the VM<li>On the host, open a Powershell as Administrator and change the session transport type:</ol><pre class=language-powershell data-lang=powershell style=color:#c0c5ce;background-color:#2b303b><code class=language-powershell data-lang=powershell><span>PS C:\Users\hugsy> </span><span style=color:#96b5b4>Set-VM </span><span>"</span><span style=color:#a3be8c>Ubuntu 18.04 x64</span><span>" -EnhancedSessionTransportType HvSocket
</span></code></pre><ol start=4><li>Start the VM. When switching to the RDP session, Hyper-V Manager will prompt the desired resolution and show the XRDP prompt. <a href=https://github.com/Microsoft/linux-vm-tools/raw/master/wiki/media/xorglogin.PNG target=_blank> <img alt=image_alt src=https://github.com/Microsoft/linux-vm-tools/raw/master/wiki/media/xorglogin.PNG title=image_alt width=100%> </a><li>Login as usual and enjoy the enhanced mode.</ol><p>For Fedora/RedHat, it <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1553453" rel="noopener nofollow noreferrer" target=_blank>may also be working</a>.<blockquote><p>Update (2019/04/28): If you‚Äôre using a different WM, you may also need to edit your <code>~/.xsession</code> to set proper WM value. For instance</blockquote><pre class=language-txt data-lang=txt style=color:#c0c5ce;background-color:#2b303b><code class=language-txt data-lang=txt><span>env -u SESSION_MANAGER -u DBUS_SESSION_BUS_ADDRESS mate-session  # for mate (could be unity, xfce4-session, gnome3, etc.)
</span></code></pre><div class=alert-info markdown=span><b class=markdown-alert-title> <svg class="octicon octicon-info mr-2" viewbox="0 0 16 16" aria-hidden=true height=16 version=1.1 width=16><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg> Note </b><p><p>To switch back to the regular view, simply click on <strong>View</strong> ‚Üí uncheck <strong>Enhanced session</strong>.</div><h2 id=sharing-folders>Sharing folders</h2><p>This is easily done using SMB: on the host, simply share (right-click on folder ‚Üí <strong>Properties</strong> ‚Üí <strong>Share</strong> tab)<h3 id=windows-guest>Windows guest</h3><p>Well it‚Äôs Windows, so just<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>C:</span><span style=color:#96b5b4>\></span><span> net use * </span><span style=color:#96b5b4>\\</span><span>HOST_HOSTNAME</span><span style=color:#96b5b4>\S</span><span>haredFolder /user:hugsy
</span></code></pre><h3 id=linux-guest>Linux guest</h3><p>Use <a rel="noopener nofollow noreferrer" href=https://samba.org target=_blank>Samba</a>:<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>$</span><span> sudo apt install cifs-utils</span><span style=color:#bf616a> -y </span><span style=color:#65737e># for the first time, just in case
</span><span style=color:#bf616a>$</span><span> mkdir</span><span style=color:#bf616a> -p ~</span><span>/Desktop/Shared
</span><span style=color:#bf616a>$</span><span> sudo mount.cifs //HOST_HOSTNAME/SharedFolder </span><span style=color:#bf616a>~</span><span>/Desktop/Shared</span><span style=color:#bf616a> -o</span><span> user=hugsy,uid=1000,gid=1000
</span></code></pre><p>And the best part is that it will all rely on Windows DACL which allows a much finer granularity in permissions than VirtualBox did.<h2 id=side-note>Side note</h2><p>Hyper-V has become really good so maybe that post will help other former Linux people like myself to reconsider, test it and maybe make the move too. That move was the last one to date for me, after moving from Linux to Windows 10 as main host OS, and then switching from my beloved Emacs to Visual Studio Code.<p>And I must say, I‚Äôve been nothing but happy about those changes‚Ä¶ Huge kudos to Microsoft! A few pros for Hyper-V are that it is totally free and integrated to the OS (assuming you have a Pro version), supports Nested Virtualization, VMs are always running headlessly, can be programmed in <a rel="noopener nofollow noreferrer" href=https://blogs.technet.microsoft.com/richard_macdonald/2008/08/11/programming-hyper-v-with-wmi-and-c-getting-started/ target=_blank>C#</a> or scripted in <a rel="noopener nofollow noreferrer" href=https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/try-hyper-v-powershell target=_blank>PowerShell</a> easily‚Ä¶ Also I personally don‚Äôt like Oracle, so if I can‚Äôt make a change to not using any of their software, it‚Äôs all for the best.<p>And this will conclude my pesky rant üòÄ<p>Some links to conclude:<ul><li><a rel="noopener nofollow noreferrer" href=https://github.com/Microsoft/linux-vm-tools target=_blank>https://github.com/Microsoft/linux-vm-tools</a><li><a rel="noopener nofollow noreferrer" href=https://blogs.technet.microsoft.com/virtualization/2018/02/28/sneak-peek-taking-a-spin-with-enhanced-linux-vms/ target=_blank>https://blogs.technet.microsoft.com/virtualization/2018/02/28/sneak-peek-taking-a-spin-with-enhanced-linux-vms/</a><li><a rel="noopener nofollow noreferrer" href=https://nbsoftsolutions.com/blog/linux-virtualization-with-a-mounted-windows-share-on-client-hyper-v target=_blank>https://nbsoftsolutions.com/blog/linux-virtualization-with-a-mounted-windows-share-on-client-hyper-v</a></ul><p>Cheatsheet over‚Ä¶<aside class=post-tags><p>Categories: <a href=https://blahcat.github.io/categories/research/>#research</a><p>Tags: <a href=https://blahcat.github.io/tags/windows/>#windows</a> <a href=https://blahcat.github.io/tags/hyperv/>#hyperv</a> <a href=https://blahcat.github.io/tags/virtualbox/>#virtualbox</a> <a href=https://blahcat.github.io/tags/cheatsheet/>#cheatsheet</a></aside><aside class=post-discussion>Join the Discussion on <a href="https://github.com/blahcat/blahcat.github.io/discussions?discussions_q=Goodbye VirtualBox, hello Hyper-V" target=_blank> <i class="fab fa-github fa-lg"></i>¬†GitHub </a></aside><aside class=post-nav><div class=container><div class=row><div class=col><b>Next:</b><br><a class=post-nav-prev href=https://blahcat.github.io/2019-01-30-playing-with-windows-root-directory-object/> <section class=post-nav-teaser><b class=post-nav-title>Scripting with Windows Root Directory Object</b><p class=post-nav-excerpt>Still on my way to learning of Windows kernel, I spend considerable amount ‚Ä¶</section> </a></div><div class=col><b>Previous:</b><br><a class=post-nav-next href=https://blahcat.github.io/2018-12-02-quick-visualization-of-a-binary-file/> <section class=post-nav-teaser><b class=post-nav-title>Quick visualization of a binary file</b><p class=post-nav-excerpt>Here‚Äôs a simple trick that I learned from the amazing @scanlime to quic‚Ä¶</section> </a></div></div></div></aside></div></div><hr><footer><div class=container><div class=row><div class="col-lg-8 col-md-10 mx-auto"><ul class="list-inline text-center"><li class=list-inline-item><a href=https://blahcat.github.io/atom.xml> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://twitter.com/ctf_blahcat> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-twitter fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://github.com/blahcat> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://www.youtube.com/channel/UCDrgY65mRZWVoMiB5-VMqfg> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-youtube fa-stack-1x fa-inverse"></i> </span> </a><li class=list-inline-item><a href=https://discord.gg/hSbqxxBgRX> <span class="fa-stack fa-lg"> <i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-discord fa-stack-1x fa-inverse"></i> </span> </a></ul><p class="copyright text-muted">Made with ‚ù§ with Zola</div></div></div></footer><script src=https://blahcat.github.io/js/jquery.min.js></script><script src=https://blahcat.github.io/js/bootstrap.bundle.min.js></script><script src=https://blahcat.github.io/js/clean-blog.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js></script><div class=mermaidTooltip style=opacity:0></div>